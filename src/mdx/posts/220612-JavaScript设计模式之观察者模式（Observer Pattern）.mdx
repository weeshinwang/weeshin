---
title: "JavaScriptè®¾è®¡æ¨¡å¼ä¹‹è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserver Patternï¼‰"
displayTitle: "JavaScript è®¾è®¡æ¨¡å¼ä¹‹è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserver Patternï¼‰"
date: 2022-06-12
lastmod: 2022-06-12
tags: [design-pattern]
categories: [ç¼–ç¨‹æŠ€æœ¯]
type: "post"
draft: false
---

> æœ¬æ–‡ç¿»è¯‘è‡ª [patterns.dev](https://www.patterns.dev/posts/observer-pattern/)

_**ğŸ‰ å½“äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œä½¿ç”¨è¢«è§‚å¯Ÿè€…æ¥é€šçŸ¥è§‚å¯Ÿè€…ã€‚**_

é€šè¿‡ä½¿ç”¨**è§‚å¯Ÿè€…æ¨¡å¼**ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿æŸç±»ç‰¹å®šçš„å¯¹è±¡ï¼ˆç§°ä¸º**è§‚å¯Ÿè€…**ï¼ŒObserversï¼‰è®¢é˜…å¦ä¸€ç±»å¯¹è±¡ï¼ˆç§°ä¸º**è¢«è§‚å¯Ÿè€…**ï¼ŒObservableï¼‰ã€‚å½“ä¸€ä¸ªäº‹ä»¶å‘ç”Ÿæ—¶ï¼Œè¢«è§‚å¯Ÿè€…å°†ä¼šé€šçŸ¥æ‰€æœ‰çš„è§‚å¯Ÿè€…ã€‚

ä¸€ä¸ªè¢«è§‚å¯Ÿå¯¹è±¡é€šå¸¸åŒ…å«ä¸‰ä¸ªé‡è¦çš„éƒ¨åˆ†ï¼š

- `è§‚å¯Ÿè€…` ï¼ˆ`observers`ï¼‰ ï¼šå½“ç‰¹å®šäº‹ä»¶å‘ç”Ÿæ—¶ä¼šæ¥æ”¶åˆ°é€šçŸ¥çš„è§‚å¯Ÿè€…æ•°ç»„ã€‚
- `subscribe()` ï¼šä¸€ä¸ªå°†è§‚å¯Ÿè€…åŠ å…¥è§‚å¯Ÿè€…åˆ—è¡¨çš„æ–¹æ³•ï¼›
- `unsubscribe()` ï¼šä¸€ä¸ªå°†è§‚å¯Ÿè€…ç§»é™¤å‡ºè§‚å¯Ÿè€…åˆ—è¡¨çš„æ–¹æ³•ï¼›
- `notify()` ï¼šä¸€ä¸ªå½“ç‰¹å®šäº‹ä»¶å‘ç”Ÿæ—¶ï¼Œé€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…çš„æ–¹æ³•ã€‚

ç›¸å½“æ£’ï¼ç°åœ¨æˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªè¢«è§‚å¯Ÿè€…å¯¹è±¡ã€‚ä¸€ç§æœ€ç®€å•åˆ›å»ºå®ƒçš„æ–¹æ³•æ˜¯ä½¿ç”¨ ES6 è¯­æ³•ä¸­çš„ [`class`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes)

```js
class Observable {
  constructor() {
    this.observers = []
  }

  subscribe(func) {
    this.observers.push(func)
  }

  unsubscribe(func) {
    this.observers = this.observers.filter((observer) => observer !== func)
  }

  notify(data) {
    this.observers.forEach((observer) => observer(data))
  }
}
```

å®Œç¾ï¼æˆ‘ä»¬ç°åœ¨å¯ä»¥é€šè¿‡è®¢é˜…ï¼ˆ`subscribe()`ï¼‰æ–¹æ³•æ¥å°†è§‚å¯Ÿè€…æ·»åŠ å…¥è§‚å¯Ÿè€…åˆ—è¡¨ï¼Œæˆ–ä½¿ç”¨å–æ¶ˆè®¢é˜…ï¼ˆ`unsubscribe()`ï¼‰çš„æ–¹æ³•æ¥å°†è§‚å¯Ÿè€…ç§»é™¤å‡ºè§‚å¯Ÿè€…åˆ—è¡¨ï¼Œäº¦æˆ–æ˜¯ä½¿ç”¨é€šçŸ¥ï¼ˆ`notify()`ï¼‰æ–¹æ³•æ¥é€šçŸ¥æ‰€æœ‰çš„è§‚å¯Ÿè€…ã€‚

è®©æˆ‘ä»¬ä½¿ç”¨è¢«è§‚å¯Ÿè€…å¯¹è±¡æ¥å†™ä¸€äº›ä»£ç ã€‚æˆ‘ä»¬æœ‰ä¸€ä¸ªéå¸¸åŸºç¡€çš„åº”ç”¨ï¼Œå®ƒä»…ä»…æœ‰ä¸¤ä¸ªç»„ä»¶æ„æˆï¼šä¸€ä¸ªæŒ‰é’®ï¼ˆ`Button`ï¼‰å’Œä¸€ä¸ªå¼€å…³ï¼ˆ`Switch`ï¼‰ã€‚

```js
export default function App() {
  return (
    <div className="App">
      <Button>Click me!</Button>
      <FormControlLabel control={<Switch />} />
    </div>
  )
}
```

æˆ‘ä»¬æƒ³è¦è¿½è¸ªç”¨æˆ·ä¸åº”ç”¨çš„**äº¤äº’**ã€‚å½“æœ‰ç”¨æˆ·ç‚¹å‡»æŒ‰é’®æˆ–åˆ‡æ¢å¼€å…³ï¼Œæˆ‘ä»¬æƒ³è®°å½•è¿™ä¸ªäº‹ä»¶å‘ç”Ÿæ—¶çš„æ—¶é—´æˆ³ã€‚åœ¨è®°å½•ä¹‹å¤–ï¼Œæˆ‘ä»¬ä¹Ÿæƒ³è¦åˆ›å»ºä¸€ä¸ªå½“äº‹ä»¶å‘ç”Ÿæ—¶å°±ä¼šå‡ºç°çš„ Toast é€šçŸ¥ã€‚

æœ¬è´¨ä¸Šï¼Œæˆ‘ä»¬æƒ³è¦åšä»¥ä¸‹çš„äº‹æƒ…ï¼š

<VideoEmbed src="https://res.cloudinary.com/ddxwdqwkr/video/upload/v1609056518/patterns.dev/jspat-41_nxsnbd.mp4" />

å½“ç”¨æˆ·è°ƒç”¨ `handleClick` æˆ–è€… `handleToggle` å‡½æ•°æ—¶ï¼Œè¿™ä¸¤ä¸ªå‡½æ•°ä¹Ÿä¼šè°ƒç”¨åœ¨è§‚å¯Ÿè€…å¯¹è±¡ä¸­çš„ `notify` æ–¹æ³•ã€‚`notify` æ–¹æ³•å°†é€šè¿‡ `handleClick` æˆ– `handleToggle` å‡½æ•°ä¼ é€’çš„æ•°æ®é€šçŸ¥ç»™æ‰€æœ‰çš„è®¢é˜…è€…ã€‚

é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ¥åˆ›å»º `logger` å’Œ `toastify` å‡½æ•°ã€‚è¿™äº›å‡½æ•°å°†æœ€ç»ˆæ¥æ”¶ä» `notify` æ–¹æ³•ä¼ é€’çš„æ•°æ®ã€‚

```js
import { ToastContainer, toast } from "react-toastify"

function logger(data) {
  console.log(`${Date.now()} ${data}`)
}

function toastify(data) {
  toast(data)
}

export default function App() {
  return (
    <div className="App">
      <Button>Click me!</Button>
      <FormControlLabel control={<Switch />} />
      <ToastContainer />
    </div>
  )
}
```

å½“å‰ï¼Œè¢«è§‚å¯Ÿè€…è¿˜ä¸èƒ½å‘ç° `logger` å’Œ `toastify` å‡½æ•°ï¼šè¢«è§‚å¯Ÿè€…è¿˜ä¸èƒ½é€šçŸ¥å®ƒä»¬ã€‚ä¸ºäº†å°†è¿™ä¸¤ä¸ªå‡½æ•°å˜ä¸ºè§‚å¯Ÿè€…ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨åœ¨è¢«è§‚å¯Ÿè€…ä¸­çš„ `subscribe` æ–¹æ³•æ¥è®¢é˜…å®ƒä»¬ã€‚

```js
import { ToastContainer, toast } from "react-toastify"

function logger(data) {
  console.log(`${Date.now()} ${data}`)
}

function toastify(data) {
  toast(data)
}

observable.subscribe(logger)
observable.subscribe(toastify)

export default function App() {
  return (
    <div className="App">
      <Button>Click me!</Button>
      <FormControlLabel control={<Switch />} />
      <ToastContainer />
    </div>
  )
}
```

è¿™æ ·ï¼Œå½“äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œ`logger` å’Œ `toastify` å‡½æ•°å°†ä¼šå¾—åˆ°é€šçŸ¥ã€‚ç°åœ¨æˆ‘ä»¬ä»…éœ€è¦å®ç°åœ¨äº‹å®ä¸Šé€šçŸ¥è¢«è§‚å¯Ÿè€…çš„å‡½æ•°ï¼š`handleClick` å’Œ `handleToggle`ã€‚è¿™äº›å‡½æ•°åº”è°ƒç”¨åœ¨è¢«è§‚å¯Ÿè€…ä¸­çš„ `notify` æ–¹æ³•ï¼Œå¹¶ä¼ é€’ç»™è§‚å¯Ÿè€…æ‰€éœ€çš„æ•°æ®ã€‚

```js
import { ToastContainer, toast } from "react-toastify"

function logger(data) {
  console.log(`${Date.now()} ${data}`)
}

function toastify(data) {
  toast(data)
}

observable.subscribe(logger)
observable.subscribe(toastify)

export default function App() {
  function handleClick() {
    observable.notify("User clicked button!")
  }

  function handleToggle() {
    observable.notify("User toggled switch!")
  }

  return (
    <div className="App">
      <Button>Click me!</Button>
      <FormControlLabel control={<Switch />} />
      <ToastContainer />
    </div>
  )
}
```

éå¸¸æ£’ï¼æˆ‘ä»¬åˆšåˆšå®Œæˆäº†æ•´ä¸ªå·¥ä½œæµï¼š`handleClick` å’Œ `handleToggle` è°ƒç”¨åœ¨è¢«è§‚å¯Ÿè€…ä¸­çš„ `notify` æ–¹æ³•ï¼Œå¹¶ä¼ é€’ç›¸å…³æ•°æ®ã€‚åœ¨æ­¤ä¹‹åï¼Œè§‚å¯Ÿè€…é€šçŸ¥æ‰€æœ‰çš„è®¢é˜…è€…ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ˜¯ä½¿ç”¨ `logger` å’Œ `toastify` å‡½æ•°æ¥å®Œæˆã€‚

å½“ç”¨æˆ·ä¸å…¶ä¸­ä¸€ä¸ªç»„ä»¶äº¤äº’å¼ï¼Œ`logger` å’Œ `toastify` å‡½æ•°ä¼šæ¥æ”¶åˆ°é€šçŸ¥ä¸ä¼ é€’ç»™ `notify` æ–¹æ³•çš„æ•°æ®ã€‚

<CodeSandbox codeSandboxId="quizzical-sinoussi-md8k5" />

å°½ç®¡æˆ‘ä»¬å¯ä»¥åœ¨å¾ˆå¤šåœ°æ–¹ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼ï¼Œå®ƒåœ¨å½“ä½¿ç”¨**å¼‚æ­¥æˆ–äº‹ä»¶ä¸ºåŸºç¡€çš„æ•°æ®**æ—¶ç›¸å½“æœ‰ç”¨ã€‚æˆ–è®¸ä½ æƒ³è¦ç‰¹å®šç»„ä»¶åœ¨æŸäº›æ•°æ®ä¸‹è½½å®Œæˆåå¾—åˆ°é€šçŸ¥ï¼Œæˆ–è€…æ˜¯ï¼Œå½“ç”¨æˆ·å‘æ¶ˆæ¯æ å‘é€æ–°æ¶ˆæ¯æ—¶ä½ æƒ³è¦æ‰€æœ‰å…¶ä»–ç”¨æˆ·æ”¶åˆ°é€šçŸ¥ã€‚

## æ¡ˆä¾‹ç ”ç©¶

ä¸€ä¸ªä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼çš„æµè¡Œ JavaScript åº“æ˜¯ `RxJS` :

> ReactiveX combines the Observer pattern with the Iterator pattern and functional programming with collections to fill the need for an ideal way of managing sequences of events. - RxJS

é€šè¿‡ RxJSï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºè¢«è§‚å¯Ÿè€…å¯¹è±¡ä»¥åŠè®¢é˜…ç‰¹å®šçš„æ—¶é—´ã€‚è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå…¶å®˜æ–¹æ–‡æ¡£ä¸­çš„ä¾‹å­ï¼šè®°å½•ç”¨æˆ·æ˜¯å¦æ‹–æ‹½æ–‡æ¡£ã€‚

<CodeSandbox codeSandboxId="stoic-turing-kqq9z" />

RxJS æœ‰éå¸¸å¤šå†…ç½®çš„ç‰¹æ€§å’Œä¾‹å­ä½¿ç”¨äº†è§‚å¯Ÿè€…æ¨¡å¼ã€‚

## ä¼˜ç‚¹

ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ–¹å¼æ¥å®è¡Œå…³æ³¨ç‚¹åˆ†ç¦»ï¼ˆSeparation of Concernsï¼‰å’Œå•ä¸€åŠŸèƒ½ ï¼ˆSingle-responsibilityï¼‰çš„åŸåˆ™ã€‚è§‚å¯Ÿè€…å¯¹è±¡ä¸è¢«è§‚å¯Ÿè€…å¯¹è±¡ä¸æ˜¯å¾ˆç´§å¯†çš„è€¦åˆï¼Œä¸”å¯ä»¥éšæ—¶è§£è€¦ã€‚è¢«è§‚å¯Ÿè€…å¯¹è±¡è´Ÿè´£ç›‘å¬äº‹ä»¶ï¼Œä¸æ­¤åŒæ—¶ï¼Œè§‚å¯Ÿè€…å¯¹è±¡ä»…è´Ÿè´£å¤„ç†æ”¶åˆ°çš„æ•°æ®ã€‚

## ç¼ºç‚¹

å¦‚æœè§‚å¯Ÿè€…å¯¹è±¡å˜å¾—éå¸¸å¤æ‚ï¼Œå½“é€šçŸ¥æ‰€æœ‰çš„è®¢é˜…è€…æ—¶ï¼Œä¼šå‡ºç°ä¸€äº›æ€§èƒ½æ–¹é¢çš„é—®é¢˜ã€‚

## å‚è€ƒæ–‡çŒ®

- [RxJS](https://rxjs-dev.firebaseapp.com/)
- [JavaScript Design Patterns: The Observer Pattern](https://www.sitepoint.com/javascript-design-patterns-observer-pattern/)
